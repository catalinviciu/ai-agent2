<div class="flex flex-col min-h-full bg-white rounded-xl relative font-sans">
    <!-- Mobile Viewport Container -->
    <div class="flex-1 bg-white flex flex-col relative">
        <!-- Scrollable Content -->
        <div class="flex-1">
            <div class="p-6 pb-24">
                <!-- Header -->
                <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                    <h2 class="font-neue-text font-bold text-[16px] leading-[22px] tracking-normal text-gray-900 m-0">
                        DVIR Form: {{ data?.Name || 'Ford Ranger - Extended Compliance with Maintenance' }}
                    </h2>
                    <div
                        class="px-2 py-0.5 border border-gray-900 rounded-full text-[10px] font-bold text-gray-900 uppercase tracking-wide">
                        MOBILE PREVIEW
                    </div>
                </div>

                <!-- Title & Instructions -->
                <div class="mb-8">
                    <h1
                        class="font-neue-text font-bold text-[16px] leading-[22px] tracking-normal text-gray-900 mb-1 m-0">
                        Start inspection</h1>
                    @if (layoutMode === 'all') {
                    <p class="font-neue-text font-normal text-[16px] leading-[22px] tracking-normal text-gray-500 m-0">
                        If a defect is found, select the cross. If no defect is found, select the check mark.
                    </p>
                    } @else {
                    <p class="font-neue-text font-normal text-[16px] leading-[22px] tracking-normal text-gray-500 m-0">
                        Add inspection details including defects (if found).
                    </p>
                    }
                </div>

                <!-- Inspection Items -->
                <div class="space-y-8">
                    @for (group of groupedItems; track group.category) {
                    <div>
                        <h4
                            class="font-neue-text font-bold text-[16px] leading-[22px] tracking-normal text-gray-900 mb-3 m-0">
                            {{ group.category }}
                        </h4>

                        <!-- Photos Grid -->
                        @if (hasPhoto(group.items)) {
                        <div class="grid grid-cols-4 gap-4 items-end">
                            @for (item of group.items; track item.Position) {
                            <div class="flex flex-col gap-2">
                                <div class="flex items-start gap-0.5 min-h-[44px]">
                                    <span
                                        class="font-neue-text font-normal text-[16px] leading-[22px] tracking-normal text-gray-900">{{
                                        item.Name }}</span>
                                    @if (item.RequireValue) { <span class="text-blue-500 text-xs font-bold">*</span> }
                                </div>
                                <button
                                    class="w-[183px] h-[80px] bg-gray-50 rounded-[12px] flex flex-col items-center justify-center gap-[10px] pt-[16px] pr-[47px] pb-[16px] pl-[47px] text-gray-500 hover:bg-gray-100 transition-all cursor-default border-none">
                                    <lucide-icon [img]="Camera" class="w-5 h-5 text-gray-900"></lucide-icon>
                                    <span class="text-[10px] text-gray-900">Take photo</span>
                                </button>
                            </div>
                            }
                        </div>
                        } @else {
                        <!-- Item List -->
                        <div class="flex flex-col border-t border-gray-100">
                            @for (item of group.items; track item.Position) {
                            <div class="flex items-center justify-between py-4 border-b border-gray-100">
                                @if (layoutMode === 'all') {
                                <!-- Submit All Mode: Item name on left, Check/X Buttons on right -->
                                <div class="flex items-center gap-1">
                                    <span
                                        class="font-neue-text font-normal text-[16px] leading-[22px] tracking-normal text-gray-900">{{
                                        item.Name || 'Item' }}</span>
                                    @if (item.RequireValue) { <span class="text-blue-500 text-xs font-bold">*</span> }
                                </div>
                                <div class="flex items-center gap-2">
                                    <button (click)="setStatus(item.Position, 'pass')"
                                        class="w-10 h-10 rounded-lg border flex items-center justify-center transition-all cursor-pointer"
                                        [class.border-gray-200]="getItemState(item.Position).status !== 'pass'"
                                        [class.bg-white]="getItemState(item.Position).status !== 'pass'"
                                        [class.border-green-500]="getItemState(item.Position).status === 'pass'"
                                        [class.bg-green-50]="getItemState(item.Position).status === 'pass'">
                                        <lucide-icon [img]="Check" class="w-5 h-5"
                                            [class.text-gray-400]="getItemState(item.Position).status !== 'pass'"
                                            [class.text-green-600]="getItemState(item.Position).status === 'pass'"></lucide-icon>
                                    </button>
                                    <button (click)="setStatus(item.Position, 'fail')"
                                        class="w-10 h-10 rounded-lg border flex items-center justify-center transition-all cursor-pointer"
                                        [class.border-gray-200]="getItemState(item.Position).status !== 'fail'"
                                        [class.bg-white]="getItemState(item.Position).status !== 'fail'"
                                        [class.border-red-500]="getItemState(item.Position).status === 'fail'"
                                        [class.bg-red-50]="getItemState(item.Position).status === 'fail'">
                                        <lucide-icon [img]="X" class="w-5 h-5"
                                            [class.text-gray-400]="getItemState(item.Position).status !== 'fail'"
                                            [class.text-red-600]="getItemState(item.Position).status === 'fail'"></lucide-icon>
                                    </button>
                                </div>
                                } @else {
                                <!-- Defects Only Mode: Checkbox on left, Item name on right -->
                                <div class="flex items-center gap-4">
                                    <button (click)="toggleChecked(item.Position)"
                                        class="w-5 h-5 rounded border flex items-center justify-center transition-all shrink-0 cursor-pointer bg-white border-gray-300">
                                        @if (getItemState(item.Position).checked) {
                                        <lucide-icon [img]="Check" class="w-4 h-4 text-gray-900"></lucide-icon>
                                        }
                                    </button>
                                    <div class="flex items-center gap-1">
                                        <span
                                            class="font-neue-text font-normal text-[16px] leading-[22px] tracking-normal text-gray-900">{{
                                            item.Name || 'Item' }}</span>
                                        @if (item.RequireValue) { <span class="text-blue-500 text-xs font-bold">*</span>
                                        }
                                    </div>
                                </div>
                                }
                            </div>
                            }
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>